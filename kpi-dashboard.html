<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI Dashboard - DSOG Stores</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        :root {
            --dark-blue: #0a192f;
            --medium-blue: #172a45;
            --light-pink: #ff6b8b;
            --accent-gold: #e6c78a;
            --soft-teal: #81c8be;
            --text-primary: #f0e6ef;
            --text-secondary: #b8b8d1;
            --success-green: #4CAF50;
            --warning-orange: #ff9800;
        }
        
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Poppins', sans-serif;
            color: var(--text-primary);
            background-color: var(--dark-blue);
            overflow-x: hidden;
        }
        
        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(circle at 25% 25%, rgba(255, 107, 139, 0.1) 0%, transparent 50%);
            background-size: 400% 400%;
            z-index: -1;
            animation: gradientMove 30s ease infinite;
        }
        
        @keyframes gradientMove {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }
        
        .container {
            min-height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--medium-blue);
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--light-pink);
        }
        
        .logo span {
            font-size: 14px;
            color: var(--text-secondary);
            display: block;
            margin-top: 5px;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s ease;
            position: relative;
            font-size: 14px;
        }
        
        .nav-link:hover, .nav-link.active {
            color: var(--light-pink);
            background-color: rgba(255, 107, 139, 0.1);
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -17px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--light-pink);
            border-radius: 3px 3px 0 0;
        }
        
        .datetime {
            text-align: right;
        }
        
        #time {
            font-size: 22px;
            font-weight: 300;
        }
        
        #date {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .admin-link {
            color: var(--accent-gold);
            font-size: 12px;
            text-decoration: none;
            display: block;
            margin-top: 5px;
            opacity: 0.8;
        }
        
        .admin-link:hover {
            opacity: 1;
        }
        
        /* KPI Dashboard */
        .kpi-dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }
        
        /* KPI Cards Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .kpi-card {
            background-color: var(--medium-blue);
            border-radius: 10px;
            padding: 25px;
            display: flex;
            align-items: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease-out;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--light-pink);
        }
        
        .kpi-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .kpi-icon {
            font-size: 32px;
            margin-right: 20px;
            width: 60px;
            height: 60px;
            background: rgba(255, 107, 139, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--light-pink);
        }
        
        .kpi-content {
            flex: 1;
        }
        
        .kpi-value {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-primary);
        }
        
        .kpi-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .kpi-trend {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            display: inline-block;
        }
        
        .trend-up {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success-green);
        }
        
        .trend-down {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }
        
        .trend-neutral {
            background: rgba(255, 152, 0, 0.2);
            color: var(--warning-orange);
        }
        
        /* Sales Target Section */
        .sales-target-section {
            background-color: var(--medium-blue);
            border-radius: 10px;
            padding: 30px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease-out;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--accent-gold);
        }
        
        .sales-target-section.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .section-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 107, 139, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title {
            font-size: 22px;
            font-weight: 500;
            color: var(--light-pink);
            margin: 0;
        }
        
        .section-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .target-progress {
            margin-bottom: 30px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .progress-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .progress-percentage {
            color: var(--accent-gold);
            font-weight: 600;
            font-size: 16px;
        }
        
        .progress-container {
            background-color: rgba(255, 107, 139, 0.1);
            height: 24px;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--light-pink), var(--accent-gold));
            border-radius: 12px;
            position: relative;
            transition: width 1.5s ease-out;
            min-width: 5%;
        }
        
        .progress-text {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: var(--dark-blue);
            font-weight: bold;
        }
        
        .target-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        
        .target-detail {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .target-detail-value {
            font-size: 22px;
            font-weight: 600;
            color: var(--soft-teal);
            margin-bottom: 5px;
        }
        
        .target-detail-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Sales Tracker Chart */
        .sales-tracker {
            margin-top: 40px;
        }
        
        .tracker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .tracker-title {
            font-size: 18px;
            color: var(--text-primary);
        }
        
        .tracker-subtitle {
            color: var(--text-secondary);
            font-size: 12px;
        }
        
        .sales-bars-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 20px;
        }
        
        .sales-bars {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            height: 180px;
            padding: 0 10px;
            position: relative;
        }
        
        /* Horizontal grid lines */
        .sales-bars::before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 25%;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .sales-bars::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .sales-bar {
            flex: 1;
            margin: 0 8px;
            background: rgba(255, 107, 139, 0.2);
            border-radius: 6px 6px 0 0;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            height: 100%;
            display: flex;
            align-items: flex-end;
        }
        
        .sales-bar:hover {
            background: rgba(255, 107, 139, 0.3);
        }
        
        .sales-bar-fill {
            background: linear-gradient(to top, var(--light-pink), var(--accent-gold));
            border-radius: 6px 6px 0 0;
            width: 100%;
            position: relative;
            transition: height 1.2s ease-out;
        }
        
        .sales-bar-label {
            position: absolute;
            bottom: -30px;
            width: 100%;
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .sales-bar-value {
            position: absolute;
            top: -25px;
            width: 100%;
            text-align: center;
            font-size: 12px;
            color: var(--accent-gold);
            font-weight: 600;
        }
        
        /* Weekly Performance */
        .weekly-performance {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }
        
        .performance-card {
            background-color: var(--medium-blue);
            border-radius: 10px;
            padding: 25px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease-out;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .performance-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .performance-card:nth-child(1) {
            border-left: 4px solid var(--soft-teal);
        }
        
        .performance-card:nth-child(2) {
            border-left: 4px solid var(--light-pink);
        }
        
        .performance-stats {
            margin-top: 20px;
        }
        
        .performance-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .performance-stat:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .stat-value {
            font-weight: 600;
            font-size: 16px;
        }
        
        /* Store Metrics */
        .store-metrics {
            margin-top: 25px;
        }
        
        .metrics-grid-small {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .metric-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .metric-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .metric-icon-small {
            font-size: 24px;
            color: var(--soft-teal);
            margin-bottom: 10px;
        }
        
        .metric-value-small {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }
        
        .metric-label-small {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Daily Breakdown */
        .daily-breakdown {
            margin-top: 40px;
        }
        
        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .day-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .day-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .day-card.best-day {
            background: rgba(255, 107, 139, 0.1);
            border: 1px solid rgba(255, 107, 139, 0.3);
        }
        
        .day-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .day-sales {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent-gold);
            margin-bottom: 5px;
        }
        
        .day-percentage {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Info Box */
        .info-box {
            background: rgba(129, 200, 190, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            border-left: 4px solid var(--soft-teal);
        }
        
        .info-title {
            color: var(--soft-teal);
            font-size: 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-text {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .nav-links {
                width: 100%;
                overflow-x: auto;
                padding-bottom: 10px;
            }
            
            .datetime {
                width: 100%;
                text-align: left;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .weekly-performance {
                grid-template-columns: 1fr;
            }
            
            .sales-bars {
                height: 150px;
            }
            
            .sales-bar {
                margin: 0 3px;
            }
            
            .sales-bar-label {
                font-size: 10px;
            }
            
            .sales-bar-value {
                font-size: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .kpi-card {
                padding: 15px;
            }
            
            .kpi-value {
                font-size: 24px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="background-pattern"></div>
    
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div>
                <div class="logo">
                    DSOG Stores - KPI Dashboard
                    <span>Real-time Performance Metrics & Analytics</span>
                </div>
                <div class="nav-links">
                    <a href="index.html" class="nav-link">Dashboard</a>
                    <a href="kpis.html" class="nav-link active">KPI's</a>
                    <a href="best-selling.html" class="nav-link">Best Selling</a>
                    <a href="new-arrivals.html" class="nav-link">New Arrivals</a>
                    <a href="admin.html" class="nav-link">Admin Panel</a>
                </div>
            </div>
            <div class="datetime">
                <div id="time">10:45 AM</div>
                <div id="date">Friday, June 10, 2023</div>
                <a href="admin.html" class="admin-link">‚öôÔ∏è Admin Control Panel</a>
            </div>
        </header>
        
        <!-- KPI Dashboard -->
        <div class="kpi-dashboard">
            
            <!-- KPI Cards Grid -->
            <div class="kpi-grid">
                <div class="kpi-card" id="kpiCard1">
                    <div class="kpi-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-value currency" id="weeklySalesKPI">14,285</div>
                        <div class="kpi-label">Weekly Sales</div>
                        <span class="kpi-trend trend-up" id="growthTrend">+12% vs last week</span>
                    </div>
                </div>
                
                <div class="kpi-card" id="kpiCard2">
                    <div class="kpi-icon">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-value" id="targetProgressKPI">65%</div>
                        <div class="kpi-label">Weekly Target Progress</div>
                        <span class="kpi-trend trend-up" id="targetTrend">On track</span>
                    </div>
                </div>
                
                <div class="kpi-card" id="kpiCard3">
                    <div class="kpi-icon">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-value" id="productsSoldKPI">117</div>
                        <div class="kpi-label">Products Sold</div>
                        <span class="kpi-trend trend-up" id="productsTrend">+8% vs target</span>
                    </div>
                </div>
                
                <div class="kpi-card" id="kpiCard4">
                    <div class="kpi-icon">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="kpi-content">
                        <div class="kpi-value" id="daysRemainingKPI">4</div>
                        <div class="kpi-label">Days Remaining</div>
                        <span class="kpi-trend trend-neutral" id="daysTrend">Week 24</span>
                    </div>
                </div>
            </div>
            
            <!-- Sales Target Section -->
            <div class="sales-target-section" id="salesTargetSection">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">üéØ Weekly Sales Target</h2>
                        <div class="section-subtitle">Performance against weekly goal</div>
                    </div>
                    <div class="progress-percentage" id="progressPercentage">65%</div>
                </div>
                
                <div class="target-progress">
                    <div class="progress-header">
                        <div class="progress-label">Weekly Progress</div>
                        <div class="progress-label"><span id="currentSales">Ksh 14,285</span> / <span id="weeklyTarget">Ksh 22,000</span></div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar">
                            <span class="progress-text">65%</span>
                        </div>
                    </div>
                </div>
                
                <div class="target-details">
                    <div class="target-detail">
                        <div class="target-detail-value currency" id="targetAchieved">14,285</div>
                        <div class="target-detail-label">Achieved</div>
                    </div>
                    <div class="target-detail">
                        <div class="target-detail-value currency" id="targetRemaining">7,715</div>
                        <div class="target-detail-label">Remaining</div>
                    </div>
                    <div class="target-detail">
                        <div class="target-detail-value" id="dailyAverage">2,857</div>
                        <div class="target-detail-label">Daily Average Needed</div>
                    </div>
                    <div class="target-detail">
                        <div class="target-detail-value" id="completionDate">June 14</div>
                        <div class="target-detail-label">Projected Completion</div>
                    </div>
                </div>
                
                <!-- Sales Tracker Chart -->
                <div class="sales-tracker">
                    <div class="tracker-header">
                        <div>
                            <h3 class="tracker-title">üìä Daily Sales Tracker</h3>
                            <div class="tracker-subtitle">Real-time sales performance by day</div>
                        </div>
                        <div class="tracker-subtitle" id="weekTotal">Week Total: <span class="currency">14,285</span></div>
                    </div>
                    
                    <div class="sales-bars-container">
                        <div class="sales-bars" id="salesBars">
                            <!-- Sales bars will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Weekly Performance -->
            <div class="weekly-performance">
                <div class="performance-card" id="performanceCard1">
                    <h3 class="section-title">üìà Performance Metrics</h3>
                    <div class="section-subtitle">Key indicators for this week</div>
                    
                    <div class="performance-stats">
                        <div class="performance-stat">
                            <span class="stat-label">Conversion Rate</span>
                            <span class="stat-value" id="conversionRate">4.2%</span>
                        </div>
                        <div class="performance-stat">
                            <span class="stat-label">Average Transaction Value</span>
                            <span class="stat-value currency" id="avgTransaction">122</span>
                        </div>
                        <div class="performance-stat">
                            <span class="stat-label">Customer Traffic</span>
                            <span class="stat-value" id="customerTraffic">2785</span>
                        </div>
                        <div class="performance-stat">
                            <span class="stat-label">Top Selling Category</span>
                            <span class="stat-value" id="topCategory">Accessories</span>
                        </div>
                    </div>
                </div>
                
                <div class="performance-card" id="performanceCard2">
                    <h3 class="section-title">üè™ Store Operations</h3>
                    <div class="section-subtitle">Operational efficiency metrics</div>
                    
                    <div class="performance-stats">
                        <div class="performance-stat">
                            <span class="stat-label">Staff Productivity</span>
                            <span class="stat-value" id="staffProductivity">87%</span>
                        </div>
                        <div class="performance-stat">
                            <span class="stat-label">Inventory Turnover</span>
                            <span class="stat-value" id="inventoryTurnover">2.4</span>
                        </div>
                        <div class="performance-stat">
                            <span class="stat-label">Customer Satisfaction</span>
                            <span class="stat-value" id="customerSatisfaction">4.7/5</span>
                        </div>
                        <div class="performance-stat">
                            <span class="stat-label">Delivery On-time Rate</span>
                            <span class="stat-value" id="deliveryRate">94%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Store Metrics -->
            <div class="store-metrics">
                <h3 class="section-title">üè¨ Store Metrics</h3>
                <div class="section-subtitle">Operational statistics across all franchises</div>
                
                <div class="metrics-grid-small">
                    <div class="metric-item">
                        <div class="metric-icon-small">
                            <i class="fas fa-store"></i>
                        </div>
                        <div class="metric-value-small" id="franchisesCount">8</div>
                        <div class="metric-label-small">Active Franchises</div>
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-icon-small">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="metric-value-small" id="staffCount">24</div>
                        <div class="metric-label-small">Staff Members</div>
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-icon-small">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="metric-value-small" id="deliveriesCount">3</div>
                        <div class="metric-label-small">Pending Deliveries</div>
                    </div>
                    
                    <div class="metric-item">
                        <div class="metric-icon-small">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="metric-value-small" id="transactionsCount">256</div>
                        <div class="metric-label-small">Daily Transactions</div>
                    </div>
                </div>
            </div>
            
            <!-- Daily Breakdown -->
            <div class="daily-breakdown">
                <h3 class="section-title">üìÖ Daily Performance Breakdown</h3>
                <div class="section-subtitle">Sales distribution across the week</div>
                
                <div class="breakdown-grid" id="dailyBreakdown">
                    <!-- Day cards will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Info Box -->
            <div class="info-box">
                <div class="info-title">
                    <i class="fas fa-info-circle"></i> About This Dashboard
                </div>
                <div class="info-text">
                    This KPI Dashboard displays real-time sales and performance metrics for DSOG Stores. 
                    All data is automatically updated from the central admin panel. Metrics are calculated 
                    based on current week performance (Week 24). For historical data or detailed reports, 
                    please contact the analytics department.
                </div>
            </div>
            
            <!-- Footer -->
            <div class="footer">
                <p>DSOG Stores KPI Dashboard ‚Ä¢ Data updates in real-time ‚Ä¢ Last updated: <span id="dataTimestamp">Just now</span></p>
                <p style="margin-top: 5px; font-size: 11px; opacity: 0.7;">
                    <i class="fas fa-sync-alt"></i> Auto-refreshes every 30 seconds ‚Ä¢ <i class="fas fa-shield-alt"></i> Data secured via Firebase
                </p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCOb4BqfiN3vt1Y13UTEpA_boCqNRH6rrQ",
            authDomain: "dsog-stores-dashboard.firebaseapp.com",
            databaseURL: "https://dsog-stores-dashboard-default-rtdb.firebaseio.com",
            projectId: "dsog-stores-dashboard",
            storageBucket: "dsog-stores-dashboard.firebasestorage.app",
            messagingSenderId: "1085972125142",
            appId: "1:1085972125142:web:9abea9ee0dd792a052c077"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializeClock();
            initializeDashboard();
            setupRealtimeUpdates();
            
            // Animate elements on scroll
            setupScrollAnimations();
        });
        
        // Clock functionality
        function initializeClock() {
            function updateClock() {
                const now = new Date();
                let hours = now.getHours();
                const ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12;
                const minutes = now.getMinutes().toString().padStart(2, '0');
                
                document.getElementById('time').textContent = `${hours}:${minutes} ${ampm}`;
                
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('date').textContent = now.toLocaleDateString('en-US', options);
            }
            
            updateClock();
            setInterval(updateClock, 60000);
        }
        
        // Initialize dashboard with data
        function initializeDashboard() {
            // Listen for real-time updates from Firebase
            database.ref('dashboard').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    updateDashboard(data);
                    updateDataTimestamp();
                }
            });
        }
        
        // Update the entire dashboard with new data
        function updateDashboard(data) {
            console.log("Updating KPI dashboard with:", data);
            
            // Update KPI cards
            updateKPICards(data);
            
            // Update sales target section
            updateSalesTarget(data);
            
            // Update sales tracker chart
            updateSalesChart(data);
            
            // Update store metrics
            updateStoreMetrics(data);
            
            // Update daily breakdown
            updateDailyBreakdown(data);
            
            // Update performance metrics
            updatePerformanceMetrics(data);
        }
        
        // Update KPI cards
        function updateKPICards(data) {
            // Weekly Sales
            const weeklySales = data.metrics?.weeklySales || 0;
            document.getElementById('weeklySalesKPI').textContent = formatNumber(weeklySales);
            
            // Growth trend
            const growth = data.metrics?.growth || 0;
            document.getElementById('growthTrend').textContent = `${growth >= 0 ? '+' : ''}${growth}% vs last week`;
            document.getElementById('growthTrend').className = `kpi-trend ${growth > 0 ? 'trend-up' : growth < 0 ? 'trend-down' : 'trend-neutral'}`;
            
            // Target progress
            const target = data.target?.weeklyTarget || 22000;
            const progress = target > 0 ? Math.round((weeklySales / target) * 100) : 0;
            document.getElementById('targetProgressKPI').textContent = `${progress}%`;
            
            // Target trend
            let targetTrend = "On track";
            if (progress < 50) targetTrend = "Needs improvement";
            else if (progress >= 100) targetTrend = "Target achieved!";
            document.getElementById('targetTrend').textContent = targetTrend;
            document.getElementById('targetTrend').className = `kpi-trend ${progress >= 75 ? 'trend-up' : progress >= 50 ? 'trend-neutral' : 'trend-down'}`;
            
            // Products sold
            const productsSold = data.metrics?.productsSold || 0;
            document.getElementById('productsSoldKPI').textContent = productsSold;
            
            // Products trend (calculate vs target of 100)
            const productsTarget = 100;
            const productsProgress = Math.round((productsSold / productsTarget) * 100);
            const productsDifference = productsProgress - 100;
            document.getElementById('productsTrend').textContent = `${productsDifference >= 0 ? '+' : ''}${productsDifference}% vs target`;
            document.getElementById('productsTrend').className = `kpi-trend ${productsDifference > 0 ? 'trend-up' : productsDifference < 0 ? 'trend-down' : 'trend-neutral'}`;
            
            // Days remaining
            const daysRemaining = data.metrics?.daysRemaining || 0;
            document.getElementById('daysRemainingKPI').textContent = daysRemaining;
            
            // Days trend
            let daysTrend = `Week ${getWeekNumber()}`;
            if (daysRemaining <= 2) daysTrend = "Week ending soon";
            document.getElementById('daysTrend').textContent = daysTrend;
        }
        
        // Update sales target section
        function updateSalesTarget(data) {
            const weeklySales = data.metrics?.weeklySales || 0;
            const target = data.target?.weeklyTarget || 22000;
            const progress = target > 0 ? Math.round((weeklySales / target) * 100) : 0;
            const remaining = Math.max(0, target - weeklySales);
            const daysRemaining = data.metrics?.daysRemaining || 4;
            const dailyAverageNeeded = daysRemaining > 0 ? Math.round(remaining / daysRemaining) : 0;
            
            // Update progress bar
            document.getElementById('progressPercentage').textContent = `${progress}%`;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressBar').querySelector('.progress-text').textContent = `${progress}%`;
            
            // Update numbers
            document.getElementById('currentSales').textContent = `Ksh ${formatNumber(weeklySales)}`;
            document.getElementById('weeklyTarget').textContent = `Ksh ${formatNumber(target)}`;
            document.getElementById('targetAchieved').textContent = formatNumber(weeklySales);
            document.getElementById('targetRemaining').textContent = formatNumber(remaining);
            document.getElementById('dailyAverage').textContent = formatNumber(dailyAverageNeeded);
            
            // Calculate projected completion date
            const completionDate = calculateCompletionDate(dailyAverageNeeded, weeklySales, target);
            document.getElementById('completionDate').textContent = completionDate;
        }
        
        // Update sales chart
        function updateSalesChart(data) {
            const dailySales = data.target?.dailySales || [0, 0, 0, 0, 0, 0, 0];
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const salesBarsContainer = document.getElementById('salesBars');
            
            // Calculate week total
            const weekTotal = dailySales.reduce((a, b) => a + b, 0);
            document.getElementById('weekTotal').innerHTML = `Week Total: <span class="currency">${formatNumber(weekTotal)}</span>`;
            
            // Find max value for scaling
            const maxValue = Math.max(...dailySales, 4000);
            
            let barsHTML = '';
            dailySales.forEach((sales, index) => {
                const percentage = maxValue > 0 ? (sales / maxValue) * 100 : 0;
                const dayName = days[index];
                
                barsHTML += `
                    <div class="sales-bar" data-day="${dayName}" data-value="${sales}">
                        <div class="sales-bar-fill" style="height: ${percentage}%"></div>
                        <div class="sales-bar-value">${sales > 0 ? 'Ksh ' + formatNumber(sales) : ''}</div>
                        <div class="sales-bar-label">${dayName}</div>
                    </div>
                `;
            });
            
            salesBarsContainer.innerHTML = barsHTML;
            
            // Add hover effects
            const salesBars = salesBarsContainer.querySelectorAll('.sales-bar');
            salesBars.forEach(bar => {
                bar.addEventListener('mouseenter', function() {
                    const day = this.getAttribute('data-day');
                    const value = parseInt(this.getAttribute('data-value'));
                    
                    // Highlight the bar
                    this.style.background = 'rgba(255, 107, 139, 0.4)';
                    
                    // You could add a tooltip or highlight effect here
                });
                
                bar.addEventListener('mouseleave', function() {
                    this.style.background = 'rgba(255, 107, 139, 0.2)';
                });
            });
        }
        
        // Update store metrics
        function updateStoreMetrics(data) {
            document.getElementById('franchisesCount').textContent = data.stats?.franchises || 0;
            document.getElementById('staffCount').textContent = data.stats?.staff || 0;
            document.getElementById('deliveriesCount').textContent = data.stats?.deliveries || 0;
            
            // Calculate daily transactions (estimated)
            const productsSold = data.metrics?.productsSold || 0;
            const daysPassed = 7 - (data.metrics?.daysRemaining || 0);
            const avgTransactions = daysPassed > 0 ? Math.round(productsSold / daysPassed / 2.5) : 0;
            document.getElementById('transactionsCount').textContent = avgTransactions;
        }
        
        // Update daily breakdown
        function updateDailyBreakdown(data) {
            const dailySales = data.target?.dailySales || [0, 0, 0, 0, 0, 0, 0];
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const weekTotal = dailySales.reduce((a, b) => a + b, 0);
            const breakdownContainer = document.getElementById('dailyBreakdown');
            
            // Find best day
            const maxSales = Math.max(...dailySales);
            const bestDayIndex = dailySales.indexOf(maxSales);
            
            let breakdownHTML = '';
            dailySales.forEach((sales, index) => {
                const percentage = weekTotal > 0 ? Math.round((sales / weekTotal) * 100) : 0;
                const isBestDay = sales > 0 && sales === maxSales;
                
                breakdownHTML += `
                    <div class="day-card ${isBestDay ? 'best-day' : ''}">
                        <div class="day-name">${days[index]}</div>
                        <div class="day-sales currency">${sales}</div>
                        <div class="day-percentage">${percentage}% of total</div>
                    </div>
                `;
            });
            
            breakdownContainer.innerHTML = breakdownHTML;
        }
        
        // Update performance metrics (calculated metrics)
        function updatePerformanceMetrics(data) {
            const weeklySales = data.metrics?.weeklySales || 0;
            const productsSold = data.metrics?.productsSold || 0;
            const target = data.target?.weeklyTarget || 22000;
            
            // Calculate metrics
            const conversionRate = productsSold > 0 ? ((productsSold / 2785) * 100).toFixed(1) : 0;
            const avgTransaction = productsSold > 0 ? Math.round(weeklySales / productsSold) : 0;
            const staffProductivity = Math.min(100, Math.round((weeklySales / target) * 100) + 35);
            const inventoryTurnover = (productsSold / 500).toFixed(1);
            
            // Update metrics
            document.getElementById('conversionRate').textContent = `${conversionRate}%`;
            document.getElementById('avgTransaction').textContent = formatNumber(avgTransaction);
            document.getElementById('customerTraffic').textContent = '2785'; // Estimated
            document.getElementById('topCategory').textContent = 'Accessories'; // From product data
            
            document.getElementById('staffProductivity').textContent = `${staffProductivity}%`;
            document.getElementById('inventoryTurnover').textContent = inventoryTurnover;
            document.getElementById('customerSatisfaction').textContent = '4.7/5'; // Estimated
            document.getElementById('deliveryRate').textContent = '94%'; // Estimated
        }
        
        // Setup real-time updates
        function setupRealtimeUpdates() {
            // Auto-refresh timestamp every 30 seconds
            setInterval(updateDataTimestamp, 30000);
            
            // You could add periodic data refresh here if needed
        }
        
        // Update data timestamp
        function updateDataTimestamp() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('dataTimestamp').textContent = `Today at ${timeString}`;
        }
        
        // Setup scroll animations
        function setupScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add("visible");
                    }
                });
            }, { threshold: 0.1 });
            
            // Observe all animatable elements
            const animatableElements = [
                'kpiCard1', 'kpiCard2', 'kpiCard3', 'kpiCard4',
                'salesTargetSection', 'performanceCard1', 'performanceCard2'
            ];
            
            animatableElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) observer.observe(element);
            });
        }
        
        // Utility functions
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        function getWeekNumber() {
            const now = new Date();
            const startDate = new Date(now.getFullYear(), 0, 1);
            const days = Math.floor((now - startDate) / (24 * 60 * 60 * 1000));
            return Math.ceil(days / 7);
        }
        
        function calculateCompletionDate(dailyAverageNeeded, currentSales, target) {
            if (dailyAverageNeeded <= 0) return "Target achieved!";
            
            const now = new Date();
            const remaining = target - currentSales;
            const daysNeeded = Math.ceil(remaining / dailyAverageNeeded);
            
            const completionDate = new Date(now);
            completionDate.setDate(now.getDate() + daysNeeded);
            
            const options = { month: 'short', day: 'numeric' };
            return completionDate.toLocaleDateString('en-US', options);
        }
        
        // Add currency formatting to elements with .currency class
        document.querySelectorAll('.currency').forEach(element => {
            const originalText = element.textContent;
            if (!isNaN(parseFloat(originalText.replace(/,/g, '')))) {
                const num = parseFloat(originalText.replace(/,/g, ''));
                element.textContent = formatNumber(num);
            }
        });
        
        // Auto-refresh data every 60 seconds (optional)
        setInterval(() => {
            console.log("Auto-refreshing KPI data...");
            // Firebase real-time listener already handles updates
        }, 60000);
    </script>
</body>
</html>
